[:arrow_left:Revenir √† la th√©orie.](../Theo/README.md)
<h1>Blade</h1>

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [1. Pr√©sentation](#1-pr√©sentation)
- [2. Les substitutions](#2-les-substitutions)
- [3. Les conditions](#3-les-conditions)
- [4. Les boucles](#4-les-boucles)
  - [4.1 foreach](#41-foreach)
  - [4.2 for](#42-for)
  - [4.3 forelse](#43-forelse)
  - [4.4 while](#44-while)
  - [4.5 La variable de boucle $loop ](#45-la-variable-de-boucle-loop-a-name45-varloopa)
- [5. Directive @PHP](#5-directive-php)
- [6. Les mod√®les](#6-les-mod√®les)
  - [6.1 Mod√®les avec h√©ritage](#61-mod√®les-avec-h√©ritage)
    - [6.1.1 Diff√©rences entre Yield et Section](#611-diff√©rences-entre-yield-et-section)
    - [6.1.2 Yield](#612-yield)
    - [6.1.3 Section](#613-section)
  - [6.2 Mod√®les avec Component](#62-mod√®les-avec-component)

<!-- /code_chunk_output -->






## 1. Pr√©sentation
Pour faire nos vues, on utilise du PHP et du HTML. Cependant, des personnes trouvent que PHP est lourd. De l√† est n√© des moteurs de templates pour palier √† cela. Blade en fait partie.

Laravel poss√®de un moteur de Template: Blade.
Il a une syntaxe tr√®s particuli√®re qui permet de vous faire gagner du temps et de cr√©er aussi des mod√®les de document.

## 2. Les substitutions
Par exemple une vue en php
```php
<p>L'article n¬∞<?php echo $numero ?> se trouve dans l'all√©e <?php echo $allee ?></p>
```
Ou pourrait utiliser la syntaxe simplifi√©e apparue dans PHP 5.4:
```php
<p>L'article n¬∞<?= $numero ?> se trouve dans l'all√©e <?= $allee ?></p>
```
Notre vue √† la sauce Blade:
```html
<p>L'article n¬∞{{$numero}} se trouve dans l'all√©e {{$allee}}</p>
```
Comme vous le constatez, on n'a pas utilis√© la directive &#x3C;?php ?&#x3E;. Mais directement en appelant nos variables re√ßues de la route: \$numero et \$allee.

Blade demande qu'on encadre les variables avec des doubles accolades ouvrantes et fermantes: {{\$numero}} et {{\$allee}}.
## 3. Les conditions
On utilise les directives @if, @else, @elseif et @endif.

Soit la route suivante:
```php
Route::get('/article', function () {
    $numero = 23;
    $allee = '6a';
    return view('article', ['numero' => $numero, 'allee' => $allee]);
});
```

La vue 'article.blade.php':
```html
<p>
    @if ($numero == 23)
        Le num√©ro 23 !? Excellent Article ! ‚ù§Ô∏è
    @elseif ($numero == 24)
        Notre second meilleur Article {{$numero}} ! Good Choice ! üòé
    @else
        Ce n'est pas notre meilleur article ({{$numero}}) mais il est cool quand m√™me. üòä
    @endif
</p>
<p>Vous pourrez le trouver dans l'all√©e {{$allee}}.</p>
```
Voici un √©quivalent en PHP (via la syntaxe alternative):
```php
<p>
    <?php if ($numero == 23): ?>
        Le num√©ro 23 !? Excellent Article ! ‚ù§Ô∏è
    <?php elseif ($numero == 24): ?>
        Notre second meilleur Article <?php echo $numero; ?> ! Good Choice ! üòé
    <?php else: ?>
        Ce n'est pas notre meilleur article (<?php echo $numero; ?>) mais il est cool quand m√™me. üòä
    <?php endif; ?>
</p>
<p>Vous pourrez le trouver dans l'all√©e <?php echo $allee; ?>.</p>
```
Syntaxe alternative: https://www.php.net/manual/fr/control-structures.alternative-syntax.php

## 4. Les boucles
Pour les exemples, nous utiliserons la route:
```php
Route::get('/vampire', function()
{
    $armes = array('pieu','ail','crucifix','soleil');
    return view('attack', ['armes' => $armes]);
});
```

### 4.1 foreach
Notre view 'attack.blade.php' sans utiliser Blade:
```php
<h1>Attaquons ces vampires ! </h1>
Pour attaquer ou √©loigner un vampire tu auras besoin d'un des √©l√©ments suivants:<br/>
<?php
foreach ($armes as $arme) {
    echo "- $arme<br/>";
}
?>
</ul>
```
Notre view 'attack.blade.php' avec Blade:
```php
<h1>Attaquons ces vampires ! </h1>
Pour attaquer ou √©loigner un vampire tu auras besoin d'un des √©l√©ments suivants:<br/>
@foreach ($armes as $arme)
    - {{$arme}}<br/>
@endforeach
```
On voit la facilit√© de lecture avec Blade. :)

### 4.2 for
La directive @for est utilis√©e pour les boucles for.
```php
<h1>Attaquons ces vampires ! </h1>
Pour attaquer ou √©loigner un vampire tu auras besoin d'un des √©l√©ments suivants:<br/>
@for ($i=0;$i<count($armes);$i++)
    - {{$armes[$i] }}<br/>
@endfor
```
### 4.3 forelse
On utilise cette directive pour afficher un message si le tableau est vide.
```php
<h1>Attaquons ces vampires ! </h1>
<p>Pour attaquer ou √©loigner un vampire tu auras besoin:</p>
@forelse ($armes as $arme)
    - {{$arme}}<br />
@empty
    Mince, je ne m'en rappelle plus ! Bonne chance ! üòÖ
@endforelse
```
### 4.4 while
On utilise la directive @while pour les boucles while.
```php
@while (true)
    <p>I'm looping forever.</p>
@endwhile
```

### 4.5 La variable de boucle $loop <a name="4.5-varloop"></a>
Lors de boucles, on peut utiliser cette variable $loop et les propri√©t√©s suivantes:


|Propri√©t√©|Description|
|---|---|
|$loop->index|L'index de l'it√©ration courante (commence √† 0)|
|$loop->iteration|	L'it√©ration courante (commence √† 1).|
|$loop->remaining|	Nombre d'it√©rations restantes.|
|$loop->count|	Le nombre total d'√©l√©ments du tableau qui est en train d'√™tre parcouru.|
|$loop->first|	S'il s'agit de la premi√®re it√©ration dans la boucle.|
|$loop->last|	S'il s'agit de la derni√®re it√©ration dans la boucle.|
|$loop->even|	S'il s'agit d'une it√©ration paire dans la boucle.|
|$loop->odd|	S'il s'agit d'une it√©ration impaire dans la boucle.|
|$loop->depth|	The nesting level of the current loop.|
|$loop->parent|	Dans une boucle imbriqu√©e, la variable $loop de boucle du parent.|


Soit le tableau de users suivant qui sera utilis√© dans nos deux exemples:
```php
@php
class User {
    public string $name;
    public int $id;
    public array $posts;

    public function __construct(string $name, int $id, array $posts) {
        $this->name = $name;
        $this->id = $id;
        $this->posts = $posts;
    }
}

$users = [
    new User('Alice', 23, ['Mon premier post', 'Mon deuxi√®me post']),
    new User('Bob', 50, ['Un autre post de Bob', 'Deuxi√®me post de Bob']),
    new User('Charlie', 75, ['Post inaugural de Charlie', 'Suite des aventures de Charlie']),
    new User('Diane', 30, ['Premier post de Diane', 'Deuxi√®me post de Diane']),
    new User('Edward', 40, ['Post de Edward', 'R√©flexions de Edward']),
    new User('Fiona', 29, ['Aventures de Fiona', 'Pens√©es de Fiona'])
];
@endphp
```

Exemple 1
```php
@foreach ($users as $user)
    @if ($loop->first)
        Ceci est la premi√®re it√©ration
    @endif

    @if ($loop->last)
        Ceci est la derni√®re it√©ration
    @endif

    <p>C'est l'utilisateur ayant l'id {{ $user->id }}</p>
@endforeach
```
Exemple 2
```php
@foreach ($users as $user)
    @if ($loop->first)
        <b>Ceci est la premi√®re it√©ration pour l'utilisateur {{ $user->name }} ayant l'id {{ $user->id }}</b>
    @elseif($loop->last)
        <b>Ceci est la derni√®re it√©ration pour l'utilisateur {{ $user->name }} ayant l'id {{ $user->id }}</b>
    @else
        <p>C'est l'utilisateur {{ $user->name }}  ayant l'id {{ $user->id }}</p>
    @endif
@endforeach
```
Ici, j'ai ajout√© une classe User et une classe Post pour les besoins de l'exemple mais normalement on ne peut pas d√©clarer de classe dans une vue. C'est juste pour l'exemple. Idem pour l'initialisation du tableau $users. Nous aurions d√ª le faire dans un contr√¥leur.

Mais vous voyez que l'on peut utiliser la variable $loop pour savoir si on est dans la premi√®re ou la derni√®re it√©ration d'une boucle. On peut aussi savoir si on est dans une it√©ration paire ou impaire. On peut aussi savoir le nombre d'it√©rations restantes, le nombre total d'√©l√©ments du tableau qui est en train d'√™tre parcouru, le niveau d'imbrication de la boucle, etc.

[:arrow_left:Revenir √† la th√©orie.](../Theo/README.md)





## 5. Directive @PHP
Parfois il peut √™tre utile d'embarquer du code PHP dans vos vues. Vous pouvez utiliser la directive Blade @php et @endphp
Exemple
```php
@php
    $counter = 1;
@endphp
```
## 6. Les mod√®les
Alors on voit que l'on peut simplifier l'√©criture de certaines pages webs gr√¢ve √† Blade.

Mais on peut aussi faire des mod√®les de documents qui pourront √™tre utilis√©s par nos vues. En gros, √ßa nous permettra de ne pas r√©p√©ter du code HTML dans toutes nos vues.

Nos vues fourniront les donn√©es n√©cessaires pour remplir le mod√®le.

Nous allons voir deux mani√®res diff√©rentes de faire des mod√®les: Avec h√©ritage d'un mod√®le ou via Component (composant).

C'est sans doute Component qui est le plus utilis√©. Mais on va voir les deux.

### 6.1 Mod√®les avec h√©ritage
Le mod√®le est une vue qui contient la structure de base de votre application. Typiquement, votre mod√®le contiendra la balise HTML, le doctype, les balises meta, les balises link vers les fichiers CSS, etc.

Les vues enfants h√©riteront de ce mod√®le et pourront remplir les sections d√©finies dans le mod√®le.

On va utiliser pour cela des directives Blade: @extends, @section, @yield et @show.

- **@section** est utilis√©e pour d√©finir une section de contenu dans une vue. Elle est utilis√©e pour d√©finir des sections qui seront remplies par les vues enfants.

- **@yield** est utilis√©e pour afficher le contenu d'une section d√©finie dans une vue parent. Elle est utilis√©e pour afficher le contenu des sections d√©finies dans le mod√®le.

- **@show** est utilis√©e pour afficher le contenu d'une section d√©finie dans une vue enfant. Elle est utilis√©e pour afficher le contenu des sections d√©finies dans le mod√®le.

- **@extends** est utilis√©e pour h√©riter d'un layout parent. Elle indique que la vue actuelle remplira les sections d√©finies dans le layout parent. La vue parent agit comme un template de base.

- **@parent** est utilis√©e pour afficher le contenu d'une section d√©finie dans une vue parent. Elle est utilis√©e pour afficher le contenu des sections d√©finies dans le mod√®le.

- **@stop** est utilis√©e pour arr√™ter la d√©finition d'une section. Elle est utilis√©e pour arr√™ter la d√©finition d'une section dans une vue parent.


Cr√©ons notre page mod√®le nomm√©e modele.blade.php
```php
<html>
    <body>
        <h1>@yield('titre')</h1>
        @section('contenu')
            <p>Contenu principal du mod√®le.</p>
        @show
    </body>
</html>
```
Et une page page.blade.php
```php
@extends('modele')
 
@section('titre')
    Mon titre
@stop
 
@section('contenu')
    @parent
    <p>Contenu de la page utilisant le mod√®le</p>
@stop
```
Ca donnera comme r√©sultat en HTML:
```html
<h1>Mon titre</h1>
<p>Contenu principal du mod√®le.</p>
<p>Contenu de la page utilisant le mod√®le</p>
```

Nous allons voir maintenant un Exemple complet
- La route:
```php
Route::get('/page{numero}', function ($numero) {
    return view("page$numero")->with('numero',$numero);
});
```
- modele avec JS et CSS Bootstrap: montemplate.balde.php
```php
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <title>@yield('titre')</title>
</head>

<body>
    <div class='container'>
        <h1>@yield('titre1')</h1>
        @section('contenu')
        @show
    </div>
    <!-- jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
</body>
</html>
```
- Page.blade.php
```php
@extends('montemplate')
 
@section('titre')
    Super page {{$numero}}!
@stop

@section('h1')
    Je suis la page{{$numero}}
@stop

@section('contenu')
    @parent
    <p>Je suis le contenu de la page {{$numero}}. </p>
    @section('tutu')

    @show
@stop
```
- Page1.blade.php
```php
@extends('page')
@section('tutu')
    <h2>Lorem Ipsum</h2>
    <p>
        Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.
    </p>
@stop
```
- Page2.blade.php
```php
@extends('page')
@section('tutu')
    <h2>Les inondations</h2>
    <p>
        Les inondations qui touchent la Belgique est une terrible catastrophe.
    </p>
@stop
```
#### 6.1.1 Diff√©rences entre Yield et Section
On peut l√©gitimement se poser la question mais quand est-ce que j'utilise @yield et @section dans mon mod√®le ? En effet tous les deux servent √† ins√©rer quelque chose.

Pour expliquer la diff√©rence, nous partirons du mod√®le nomm√© modele.blade.php:

```php
    <h1> @yield("titre1") </h1>
    @section("contenu")
    Contenu venant du mod√®le.
    @show
```

#### 6.1.2 Yield
Utilisez @yield dans le mod√®le si vous souhaitez √©craser compl√®tement les donn√©es enfants sur la mise en page principale.

Exemple de remplissage dans page.blade.php
```php
@extends("modele")
@section("titre1")
    Ce texte est en h1
@stop
```
R√©sultat:
```console
Ce titre est en h1
Contenu venant du mod√®le.
```

#### 6.1.3 Section
Utilisez @section dans le mod√®le si vous souhaitez utiliser les donn√©es du mod√®le et les donn√©es de la page enfant ensemble avec @parent.

Exemple de remplissage dans page.blade.php
```php
@extends("modele")
@section("contenu")
    @parent
    Contenu venant de la page enfant.
@show
```
R√©sultat:
```console
Ce titre est en h1
Contenu venant du mod√®le.
Contenu venant de la page enfant.
```

### 6.2 Mod√®les avec Component
Alors ici on va cr√©er notre mod√®le √† partir d'un fichier nomm√© par exemple: modele.blade.php qui se trouvera dans le r√©pertoire app/ressources/views/components

On va cr√©er ce fichier modele.blade.php via php artisan avec la commande

```bash
php artisan make:component modele
```

Cette commande cr√©era aussi pour vous un autre fichier app\View\Components\modele.php

Notre modele pourrait par exemple contenir:
```php
<!DOCTYPE html>
<html>
    <head>
        <title>{{ $title ?? 'Todo Manager' }}</title>
    </head>
    <body>
        <h1>{{ $titreH1 }}</h1>
        <hr/>
        {{ $slot }}
    </body>
</html>
```
Utilisons maintenant notre composant dans la vue suivante:
```php
<x-modele>
    <x-slot name="title">
        Programme de la journ√©e
    </x-slot>

    <x-slot name="titreH1">
        Welcome !
    </x-slot>

    Je suis ce qui va appara√Ætre dans $slot car je ne fais pas partie d'un 'x-slot'.
</x-modele>
```
On constate que nous avons cr√©√© une balise \<x-modele> et que cette balise comporte le nom de notre composant: modele.

Si on veut garnir \$title ou \$titreH1 de notre modele, nous utiliserons la balise \<x-slot> avec l'attribut name o√π l'on donne comme valeur le nom de la variable √† remplacer: title ou titreH1.

La variable $slot sera remplie par tout ce qui sera affich√© en dehors des balises \<x-slot>.


Que va faire ce code ? 
```
{{ $title ?? 'Todo Manager' }}
```
Si \$title n'est pas nul alors on affiche la valeur de \$title sinon on affiche la valeur 'Todo Manager'

[:arrow_left:Revenir √† la th√©orie.](../Theo/README.md)

---
_[Eqla](http://www.eqla.be) 2024 - Formation Laravel_
