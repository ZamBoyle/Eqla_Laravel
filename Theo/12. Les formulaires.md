[:arrow_left:Revenir à la théorie.](../Theo/README.md)
<h1>Les formulaires</h1>



## 1. Introduction
Les formulaires sont faciles à mettre en place. Nous allons voir comment faire un formulaire, appeler la route, utiliser les données reçues et la protection CSRF.

## 2. POST Method
Soit le formulaire suivant search.blade.php:
```php
    <form action="{{ url('users') }}" method="POST">
        <label for="nom">Entrez votre nom : </label>
        <input type="text" name="name" id="name"><br/>
        <label for="nom">Entrez votre prénom : </label>
        <input type="text" name="firstname" id="firstname"><br/>
        <input type="submit" value="Envoyer !">
    </form>
```
On voit que l'on va utiliser la méthode POST. De plus, dans l'attribut action on indique l'url ('users'). C'est à dire que l'on va utiliser ici la route 'users' avec la méthode POST.

## 3. Les routes avec ::post
Nous avons notre formulaire qui indique l'url et la méthode POST. Créons maintenant notre route 'users':
```php
route::post('users', [PersonController::class, 'searchForm']);
```
Au lieu d'utiliser 'get' comme méthode statique, on utilise 'post'.
On appellera la méthode 'searchForm' du contrôleur 'PersonController'.

## 4. Protection CSRF
Nativement Laravel vous protège des attaques du type CSRF.
Quest-ce que le CSRF ? 
Reprenons l'explication donnée dans Wikipedia:
> En sécurité des systèmes d'information, le cross-site request forgery, abrégé CSRF (parfois prononcé sea-surf en anglais) ou XSRF, est un type de vulnérabilité des services d'authentification web.
> 
> L’objet de cette attaque est de transmettre à un utilisateur authentifié une requête HTTP falsifiée qui pointe sur une action interne au site, afin qu'il l'exécute sans en avoir conscience et en utilisant ses propres droits. L’utilisateur devient donc complice d’une attaque sans même s'en rendre compte. L'attaque étant actionnée par l'utilisateur, un grand nombre de systèmes d'authentification sont contournés.
> 
> Les caractéristiques du CSRF sont un type d'attaque qui :
>
> - implique un site qui repose sur l'authentification globale d'un utilisateur ;
> - exploite cette confiance dans l'authentification pour autoriser des actions implicitement ;
> - envoie des requêtes HTTP à l'insu de l'utilisateur qui est dupé pour déclencher ces actions.
> Pour résumer, les sites sensibles au CSRF sont ceux qui acceptent les actions sur le simple fait de l'authentification à un instant donné de l'utilisateur et non sur une autorisation explicite de l'utilisateur pour une action donnée.
>
> Il est important de souligner que ces attaques peuvent aussi être menées sur des intranets pour permettre à un attaquant de récupérer des informations sur ledit intranet.

source: [wikipedia](https://fr.wikipedia.org/wiki/Cross-site_request_forgery)

## 5. Exemple d'attaque CSRF
On va imaginer que votre courrier électronique accepte d'afficher les images automatiquement et qu'il affiche le code html. 
```html
<img src="https://tutubanque.be/transfert?montant=10000&vers_compte=13579" height='1' width='1'/>
```
Si pendant la lecture de votre email, vous êtes connecté sur le site non protégé banque.be et que l'url est correcte. Alors une transaction de 10000€ vers le compte 13579 vient d'être effectuée...
L'attaque est la même dans une page web sur un autre site ou via js...

## 6. Laravel et la directive @csrf
Laravel refusera de traiter toute demande d'un formulaire qui ne contiendra pas la directive @csrf.
Il en est de même pour le formulaire créé plus haut.
Le site retournera l'erreur: '419 PAGE EXPIRED'
 


[:arrow_left:Revenir à la théorie.](../Theo/README.md)

---
_[Eqla](http://www.eqla.be) 2021 - Formation Laravel_